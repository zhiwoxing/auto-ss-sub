name: Update SS Subscription

# ğŸ‘‡ğŸ‘‡ğŸ‘‡ è¿™ä¸€æ®µéå¸¸é‡è¦ï¼Œæ²¡æœ‰å®ƒæ— æ³•è‡ªåŠ¨ä¿å­˜ ğŸ‘‡ğŸ‘‡ğŸ‘‡
permissions:
  contents: write
# ğŸ‘†ğŸ‘†ğŸ‘† å¿…é¡»åŠ ä¸Šè¿™ä¸€æ®µ ğŸ‘†ğŸ‘†ğŸ‘†

on:
  schedule:
    - cron: "0 */3 * * *" # æ¯3å°æ—¶è¿è¡Œä¸€æ¬¡
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è¿è¡Œ

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Download and Process
        run: |
          # 1. ä¸‹è½½åŸå§‹çš„ snippet æ–‡ä»¶
          curl -s https://raw.githubusercontent.com/WeiGiegie/vpm/main/lq.snippet > raw.txt
          
          # 2. è¿›è¡Œ Base64 ç¼–ç  (è¿™ä¸€æ­¥å°±æ˜¯æŠŠç”Ÿè‚‰ç…®æˆç†Ÿè‚‰)
          # å¹¶å°†ç»“æœä¿å­˜ä¸º sub.txt
          base64 raw.txt | tr -d '\n' > sub.txt
          
          # 3. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
          rm raw.txt

      - name: Commit and push
        run: |
          git config --local user.email "actions@github.com"
          git config --local user.name "GitHub Actions"
          git add sub.txt
          # å¦‚æœæ²¡æœ‰å˜åŒ–å°±ä¸æäº¤ï¼Œé˜²æ­¢æŠ¥é”™
          git commit -m "Auto update subscription" || exit 0
          git push
